#!/usr/bin/env bash
# aqua-installer - shell script to install aqua
# https://github.com/suzuki-shunsuke/aqua-installer

set -eux

AQUA_VERSION=${AQUA_VERSION:-v0.1.0-4} # renovate: depName=suzuki-shunsuke/aqua
AQUA_INSTALL_PATH=${AQUA_INSTALL_PATH:-/usr/local/bin/aqua}

uname_os() {
  local os
  os=$(uname -s | tr '[:upper:]' '[:lower:]')
  case "$os" in
    cygwin_nt*) os="windows" ;;
    mingw*) os="windows" ;;
    msys_nt*) os="windows" ;;
  esac
  echo "$os"
}

uname_arch() {
  local arch
  arch=$(uname -m)
  case $arch in
    x86_64) arch="amd64" ;;
    aarch64) arch="arm64" ;;
  esac
  echo ${arch}
}

OS="$(uname_os)"
ARCH="$(uname_arch)"

mkdir -p "$(dirname "$AQUA_INSTALL_PATH")"

URL=https://github.com/suzuki-shunsuke/aqua/releases/download/${AQUA_VERSION}/aqua_${OS}_${ARCH}.tar.gz
tempdir=$(mktemp -d)
echo "===> Downloading $URL..." >&2
curl --fail -L "$URL" -o "$tempdir/aqua_${OS}_${ARCH}.tar.gz"

(cd "$tempdir"; tar xvzf "aqua_${OS}_${ARCH}.tar.gz")
echo "===> Installing aqua $AQUA_VERSION ($OS/$ARCH) to $AQUA_INSTALL_PATH ..." >&2

mv "$tempdir/aqua" "$AQUA_INSTALL_PATH"

rm -R "$tempdir"

chmod a+x "$AQUA_INSTALL_PATH"
